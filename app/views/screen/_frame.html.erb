<% frames.each do |frame| %>
  <style>
    #frame_<%= frame.id %> {
      top: <%= frame.top %>px;
      left: <%= frame.left %>px;
      width: <%= frame.width %>px;
      height: <%= frame.height %>px;
    }
  </style>

  <div id="frame_<%= frame.id %>" class="frame">

    <%

      # TODO: Refactor to helper
      events = Event.all(:conditions => {
                           :event_type_id => EventType.find_by_sources_and_names(
                                                Tag.sources_for_tagname(frame.tag),
                                                Tag.names_for_tagname(frame.tag)
                                              )
                          },
                          :order => "id DESC",
                          :limit => 10)

    %>

    <script type="text/javascript">
      var r = Raphael("frame_<%= frame.id %>");
      x = [[<% events.each_with_index do |event, index| %><%= index %>, <% end %>]]
      data = [[<% events.each do |event| %><%= event.value %>, <% end %>]]
      //r.g.linechart(20, 0, 200, 180, x, data, {nostroke: false, axis: "0 0 1 1", symbol: "o", smooth: true, shade: true});
      r.g.linechart(20, 0, 200, 180, [[1, 2, 3, 7, 10], [1, 3, 9, 10]], [[22, 34, 20, 29, 23], [15, 33, 17, 29]], {nostroke: false, axis: "0 0 1 1", symbol: "o", smooth: true, shade: true});
    </script>
  </div>
  
<% end %>
