<%= div_for tag do %>
  <h2 class="name"><%= tag.name %></h2>

  <div class="content">
    <% if (!tag.tags.empty?) then %>

      <div class="elements_block">
        <h3>Tags:</h3>
        <div class="elements subtags">
          <% tag.tags.each do |subtag| %>
            <span class="element subtag"><%= subtag %></span>
          <% end %>
        </div>
      </div>

    <% end %>

    <div class="elements_block">
      <h3>Event sources:</h3>
      <div class="elements sources">
        <% tag.resolved_event_sources.each do |event_source| %>
          <span class="element source"><%= event_source %></span>
        <% end %>
      </div>
    </div>

    <div class="elements_block">
      <h3>Event names:</h3>
      <div class="elements names">
        <% tag.resolved_event_names.each do |event_name| %>
          <span class="element name"><%= event_name %></span>
        <% end %>
      </div>
    </div>

    <div class="eventsarea">
      <%= link_to('Show latest events',
                  { :controller => "events",
                    :action => "latest",
                    :format => "json",
                    :tag_id => tag.id
                  },
                  :method => "get",
                  :remote => true,
                  :complete => 'See below:',
                  :disable_with => 'loading...',
                  :id => 'link_events_tagid_' + tag.id
                 )
      %>

      <pre id="events_tagid_<%= tag.id %>" class="events"></pre>

      <script type="text/javascript">
        $('#link_events_tagid_<%= tag.id %>').bind('ajax:success', function(event, data, status, xhr) {
          $("#events_tagid_<%= tag.id %>").hide();
          $("#events_tagid_<%= tag.id %>").html('');

          var json = $.parseJSON(xhr.responseText);
          for (key in json) {
            $('#events_tagid_<%= tag.id %>').append(json[key].id);
            $('#events_tagid_<%= tag.id %>').append('	');
            $('#events_tagid_<%= tag.id %>').append(json[key].created_at);
            $('#events_tagid_<%= tag.id %>').append('	');
            $('#events_tagid_<%= tag.id %>').append(json[key].name);
            $('#events_tagid_<%= tag.id %>').append('	');
            $('#events_tagid_<%= tag.id %>').append(json[key].source);
            $('#events_tagid_<%= tag.id %>').append('	');
            $('#events_tagid_<%= tag.id %>').append(json[key].value);
            $('#events_tagid_<%= tag.id %>').append('<br />');
          }
          
          $("#events_tagid_<%= tag.id %>").slideDown(400);
        });
      </script>

    </div>

  </div>

<% end %>
